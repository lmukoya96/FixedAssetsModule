@page
@model TestModule.Pages.AssetPages.IndexModel
@{
    ViewData["Title"] = "Asset Management";
}

@if (TempData["Message"] != null)
{
    <div class="alert alert-info">
        @TempData["Message"]
    </div>
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="h3 mb-1 text-primary">
            <i class="fas fa-box me-2"></i>Asset Management
        </h2>
        <p class="text-muted mb-0">Manage company assets and their financial details</p>
    </div>
</div>

<!-- Action Buttons Section -->
<div class="d-flex flex-column gap-3 mb-4">
    <!-- Main Action Buttons Row -->
    <div class="d-flex flex-wrap gap-2 align-items-center">
        <!-- Primary Actions -->
        <a asp-page="Create" class="btn btn-primary btn-sm">
            <i class="fas fa-plus-circle me-1"></i>Create
        </a>
        <a asp-page="Transactions" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-exchange-alt me-1"></i> Transactions
        </a>

        <!-- Reports -->
        <a asp-page="AllAssetsCostAndDepreciation" class="btn btn-outline-info btn-sm">
            <i class="fas fa-calculator me-1"></i> Assets Cost
        </a>
        <a asp-page="AllAssetsDepreciation" class="btn btn-outline-info btn-sm">
            <i class="fas fa-chart-line me-1"></i> Assets Depreciation
        </a>

        <!-- Export -->
        <form method="post" asp-page-handler="Export" class="d-inline">
            <button type="submit" class="btn btn-success btn-sm">
                <i class="fas fa-file-csv me-1"></i> Export
            </button>
        </form>

        <!-- Navigation -->
        <a asp-page="/Index" class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-home me-1"></i> Home
        </a>
    </div>

    <!-- Email Export Row -->
    <div class="d-flex align-items-center gap-2">
        <form method="post" asp-page-handler="ExportAndSend" class="d-flex align-items-center gap-2">
            <div class="input-group input-group-sm" style="width: 300px;">
                <span class="input-group-text">
                    <i class="fas fa-envelope"></i>
                </span>
                <input type="email" name="RecipientEmail" placeholder="Enter E-Mail address"
                       class="form-control form-control-sm" required />
            </div>
            <button type="submit" class="btn btn-warning btn-sm">
                <i class="fas fa-paper-plane me-1"></i> Export & Send
            </button>
            <div asp-validation-summary="All" class="text-danger small"></div>
        </form>
    </div>
</div>

<div class="card shadow-sm border-0">
    <div class="card-header bg-primary text-white py-3">
        <h5 class="mb-0">
            <i class="fas fa-list me-2"></i>Assets List
        </h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover table-striped mb-0">
                <thead class="table-dark">
                    <tr>
                        <th><i class="fas fa-hashtag me-1"></i>Code</th>
                        <th><i class="fas fa-file-alt me-1"></i>Description</th>
                        <th><i class="fas fa-layer-group me-1"></i>Group</th>
                        <th><i class="fas fa-tag me-1"></i>Category</th>
                        <th><i class="fas fa-building me-1"></i>Department</th>
                        <th><i class="fas fa-map-marker-alt me-1"></i>Location</th>
                        <th class="text-center"><i class="fas fa-calendar me-1"></i>Purchase Date</th>
                        <th class="text-center"><i class="fas fa-money-bill me-1"></i>Cost</th>
                        <th class="text-center"><i class="fas fa-barcode me-1"></i>Tracking</th>
                        <th class="text-center"><i class="fas fa-cogs me-1"></i>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Items)
                    {
                        <tr class="align-middle">
                            <td class="fw-semibold text-primary">@item.Code</td>
                            <td>@item.Description</td>
                            <td><span class="badge bg-secondary">@item.AssetGroup</span></td>
                            <td><span class="badge bg-info">@item.AssetCategory</span></td>
                            <td>@item.Department</td>
                            <td>@item.Location</td>
                            <td class="text-center">@item.PurchaseDate.ToString("dd MMM yy")</td>
                            <td class="text-end fw-bold text-success">@item.Cost.ToString("C")</td>
                            <td class="text-center">
                                @if (!string.IsNullOrEmpty(item.TrackingCode))
                                {
                                    <span class="badge bg-warning text-dark">@item.TrackingCode</span>
                                }
                                else
                                {
                                    <span class="text-muted">-</span>
                                }
                            </td>
                            <td class="text-center">
                                <div class="btn-group" role="group">
                                    <a asp-page="Info" asp-route-code="@item.Code"
                                       class="btn btn-outline-primary btn-sm" title="View Asset">
                                        <i class="fas fa-info"></i>
                                    </a>
                                    <a asp-page="Edit" asp-route-code="@item.Code"
                                       class="btn btn-outline-primary btn-sm" title="Edit Asset">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a asp-page="Delete" asp-route-code="@item.Code"
                                       class="btn btn-outline-danger btn-sm" title="Delete Asset">
                                        <i class="fas fa-trash-alt"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer bg-light py-3">
        <div class="row align-items-center">
            <div class="col-md-6">
                <span class="text-muted">
                    <i class="fas fa-database me-1"></i>Total: @Model.Items.Count() assets
                </span>
            </div>
            <div class="col-md-6 text-md-end">
                <span class="text-muted small">
                    <i class="fas fa-info-circle me-1"></i>Total Value: @Model.Items.Sum(i => i.Cost).ToString("C")
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Quick Stats Card -->
<div class="card mt-4 border-success">
    <div class="card-header bg-success text-white py-2">
        <h6 class="mb-0">
            <i class="fas fa-chart-bar me-1"></i>Assets Overview
        </h6>
    </div>
    <div class="card-body py-3">
        <div class="row text-center">
            <div class="col-md-3">
                <small class="text-muted">Total Assets</small>
                <h5 class="text-success mb-0">@Model.Items.Count()</h5>
            </div>
            <div class="col-md-3">
                <small class="text-muted">Total Value</small>
                <h5 class="text-primary mb-0">@Model.Items.Sum(i => i.Cost).ToString("C")</h5>
            </div>
            <div class="col-md-3">
                <small class="text-muted">This Month</small>
                <h5 class="text-warning mb-0">@Model.Items.Count(i => i.PurchaseDate.Month == DateTime.Now.Month && i.PurchaseDate.Year == DateTime.Now.Year)</h5>
            </div>
        </div>
    </div>
</div>

<style>
    .table th {
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
        border-bottom: 2px solid #007bff !important;
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        white-space: nowrap;
    }

    .table td {
        font-size: 0.9rem;
        vertical-align: middle;
    }

    .table-hover tbody tr:hover {
        background-color: rgba(0, 123, 255, 0.08) !important;
        transform: scale(1.01);
        transition: all 0.2s ease;
    }

    .btn-group .btn {
        border-radius: 6px;
        margin: 0 2px;
        padding: 0.3rem 0.6rem;
        font-size: 0.8rem;
    }

        .btn-group .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

    .card {
        border-radius: 15px;
        overflow: hidden;
    }

    .card-header {
        border-bottom: 2px solid rgba(255,255,255,0.2) !important;
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;
    }

    .table-responsive {
        border-radius: 0 0 15px 15px;
        overflow-x: auto;
    }

    .badge {
        font-size: 0.75rem;
        font-weight: 500;
    }

    .text-end {
        text-align: right !important;
    }
</style>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('.table').on('mouseenter', 'tr', function() {
                $(this).addClass('shadow-sm');
            }).on('mouseleave', 'tr', function() {
                $(this).removeClass('shadow-sm');
            });

            $('#searchInput').on('keyup', function() {
                const value = $(this).val().toLowerCase();
                $('tbody tr').filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });
    </script>
}

<!-- Empty State -->
@if (!Model.Items.Any())
{
    <div class="text-center py-5">
        <i class="fas fa-box fa-4x text-muted mb-3"></i>
        <h4 class="text-muted">No Assets Found</h4>
        <p class="text-muted">Get started by adding your first asset.</p>
        <a asp-page="Create" class="btn btn-primary mt-2">
            <i class="fas fa-plus me-2"></i>Add First Asset
        </a>
    </div>
}